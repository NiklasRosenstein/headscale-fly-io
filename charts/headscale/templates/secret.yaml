{{- if not .Values.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "headscale.fullname" . }}
  labels:
    {{- include "headscale.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.noisePrivateKey }}
  noise-private-key: {{ .Values.noisePrivateKey | b64enc | quote }}
  {{- else }}
  # Auto-generated noise private key (format: privkey:<64-hex-chars>)
  noise-private-key: {{ printf "privkey:%s" (randAlphaNum 64 | lower) | b64enc | quote }}
  {{- end }}
  {{- if .Values.litestream.enabled }}
  {{- if .Values.litestream.ageSecretKey }}
  age-secret-key: {{ .Values.litestream.ageSecretKey | b64enc | quote }}
  {{- else }}
  # Note: AGE key should be generated properly using age-keygen
  # This is a placeholder - please provide a real AGE secret key
  age-secret-key: {{ printf "AGE-SECRET-KEY-PLACEHOLDER-%s" (randAlphaNum 40) | b64enc | quote }}
  {{- end }}
  {{- end }}
  {{- if .Values.headplane.enabled }}
  {{- if .Values.headplane.cookieSecret }}
  headplane-cookie-secret: {{ .Values.headplane.cookieSecret | b64enc | quote }}
  {{- else }}
  # Auto-generated headplane cookie secret (32 characters hex)
  headplane-cookie-secret: {{ randAlphaNum 32 | lower | b64enc | quote }}
  {{- end }}
  {{- end }}
{{- end }}
---
{{- if and .Values.litestream.enabled (not .Values.litestream.aws.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "headscale.litestream.awsSecretName" . }}
  labels:
    {{- include "headscale.labels" . | nindent 4 }}
type: Opaque
data:
  {{ .Values.litestream.aws.accessKeyIdKey }}: {{ .Values.litestream.aws.accessKeyId | b64enc | quote }}
  {{ .Values.litestream.aws.secretAccessKeyKey }}: {{ .Values.litestream.aws.secretAccessKey | b64enc | quote }}
{{- end }}
---
{{- if and .Values.headscale.oidc.enabled (not .Values.headscale.oidc.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "headscale.oidc.secretName" . }}
  labels:
    {{- include "headscale.labels" . | nindent 4 }}
type: Opaque
data:
  oidc-client-secret: {{ .Values.headscale.oidc.clientSecret | b64enc | quote }}
{{- end }}
---
{{- if and .Values.headplane.enabled .Values.headplane.oidc.enabled (not .Values.headplane.oidc.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "headscale.headplane.oidc.secretName" . }}
  labels:
    {{- include "headscale.labels" . | nindent 4 }}
type: Opaque
data:
  headplane-oidc-client-secret: {{ .Values.headplane.oidc.clientSecret | b64enc | quote }}
  headplane-oidc-headscale-api-key: {{ .Values.headplane.oidc.headscaleApiKey | b64enc | quote }}
{{- end }}